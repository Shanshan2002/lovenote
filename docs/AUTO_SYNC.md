# ğŸ”„ è‡ªåŠ¨å¤‡ä»½å’ŒåŒæ­¥æŒ‡å—

## ğŸ¯ å®Œæ•´è‡ªåŠ¨åŒ–ç³»ç»Ÿ

### å·²å®ç°çš„è‡ªåŠ¨åŒ–åŠŸèƒ½

---

## ğŸ“¦ 1. å®æ—¶è‡ªåŠ¨å¤‡ä»½ï¼ˆå·²å¯ç”¨ï¼‰âœ…

### å·¥ä½œåŸç†

æ¯æ¬¡é‡è¦æ“ä½œéƒ½ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½ï¼š

```
ç”¨æˆ·æ“ä½œ â†’ è§¦å‘å¤‡ä»½
  â†“
ç”¨æˆ·æ³¨å†Œ â†’ backup_TIMESTAMP_user_register
æ¶ˆæ¯å‘é€ â†’ backup_TIMESTAMP_message_sent  
ç”¨æˆ·åˆ é™¤ â†’ backup_TIMESTAMP_user_deleted
```

### ä»£ç å®ç°

å·²é›†æˆåœ¨ `src/backup.js` ä¸­ï¼š
```javascript
// ç”¨æˆ·æ³¨å†Œå
createBackup('user_register');

// æ¶ˆæ¯å‘é€å
createBackup('message_sent');

// ç”¨æˆ·åˆ é™¤å
createBackup('user_deleted');
```

**æ— éœ€é…ç½®ï¼Œå·²è‡ªåŠ¨è¿è¡Œï¼** âœ…

---

## â° 2. å®šæ—¶è‡ªåŠ¨å¤‡ä»½

### å¿«é€Ÿé…ç½®

```bash
./scripts/setup-auto-backup.sh
```

### é…ç½®é€‰é¡¹

1. **æ¯å°æ—¶å¤‡ä»½**ï¼ˆæ¨èå¼€å‘ï¼‰
   - é€‚åˆï¼šé¢‘ç¹ä¿®æ”¹
   - å®šæ—¶ï¼šæ¯å°æ—¶æ•´ç‚¹

2. **æ¯å¤©å¤‡ä»½**ï¼ˆæ¨èæ—¥å¸¸ï¼‰â­
   - é€‚åˆï¼šæ—¥å¸¸ä½¿ç”¨
   - å®šæ—¶ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹

3. **æ¯å‘¨å¤‡ä»½**ï¼ˆæ¨èç¨³å®šï¼‰
   - é€‚åˆï¼šç¨³å®šä½¿ç”¨
   - å®šæ—¶ï¼šæ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹

### æ‰‹åŠ¨é…ç½®

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
0 2 * * * /path/to/scripts/auto-backup.sh
```

### æŸ¥çœ‹é…ç½®

```bash
# æŸ¥çœ‹å½“å‰å®šæ—¶ä»»åŠ¡
crontab -l

# æŸ¥çœ‹å¤‡ä»½æ—¥å¿—
tail -f logs/auto-backup.log
```

---

## ğŸ”„ 3. æ•°æ®ç›‘æ§å’ŒåŒæ­¥

### å®æ—¶ç›‘æ§ï¼ˆå¯é€‰ï¼‰

```bash
# å¯åŠ¨ç›‘æ§
./scripts/watch-and-sync.sh
```

**åŠŸèƒ½ï¼š**
- æ¯30ç§’æ£€æŸ¥æ•°æ®å˜åŒ–
- æ£€æµ‹åˆ°å˜åŒ–è‡ªåŠ¨å¤‡ä»½
- å¯é€‰è‡ªåŠ¨åŒæ­¥åˆ°Railway

### åå°è¿è¡Œ

```bash
# ä½¿ç”¨nohupåå°è¿è¡Œ
nohup ./scripts/watch-and-sync.sh > logs/watch.log 2>&1 &

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep watch-and-sync

# åœæ­¢ç›‘æ§
kill <PID>
```

---

## ğŸš€ 4. Railwayè‡ªåŠ¨åŒæ­¥

### æ–¹æ³•Aï¼šæ‰‹åŠ¨åŒæ­¥ï¼ˆæ¨èï¼‰

```bash
# éœ€è¦æ—¶è¿è¡Œ
./scripts/sync-to-railway.sh
```

### æ–¹æ³•Bï¼šå®šæ—¶åŒæ­¥

```bash
# ç¼–è¾‘crontab
crontab -e

# æ¯å¤©å‡Œæ™¨3ç‚¹åŒæ­¥åˆ°Railway
0 3 * * * /path/to/scripts/sync-to-railway.sh
```

### æ–¹æ³•Cï¼šGité’©å­åŒæ­¥

åˆ›å»º `.git/hooks/post-commit`:
```bash
#!/bin/bash
# æ¯æ¬¡æäº¤ååŒæ­¥æ•°æ®
./scripts/sync-to-railway.sh
```

---

## ğŸ“Š å¤‡ä»½ç­–ç•¥æ€»ç»“

### å¤šå±‚ä¿æŠ¤

```
1ï¸âƒ£  å®æ—¶å¤‡ä»½ï¼ˆå·²å¯ç”¨ï¼‰
    â”œâ”€ ç”¨æˆ·æ³¨å†Œ â†’ è‡ªåŠ¨
    â”œâ”€ æ¶ˆæ¯å‘é€ â†’ è‡ªåŠ¨
    â””â”€ ç”¨æˆ·åˆ é™¤ â†’ è‡ªåŠ¨

2ï¸âƒ£  å®šæ—¶å¤‡ä»½ï¼ˆå»ºè®®é…ç½®ï¼‰
    â””â”€ æ¯å¤©å‡Œæ™¨2ç‚¹ â†’ crontab

3ï¸âƒ£  æ‰‹åŠ¨å¤‡ä»½ï¼ˆéšæ—¶å¯ç”¨ï¼‰
    â””â”€ ./scripts/backup-data.sh

4ï¸âƒ£  å¯¼å‡ºå¤‡ä»½ï¼ˆè¿ç§»ç”¨ï¼‰
    â””â”€ ./scripts/export-data.sh
```

### å¤‡ä»½ä¿ç•™ç­–ç•¥

- **å®æ—¶å¤‡ä»½**ï¼šä¿ç•™æœ€è¿‘10ä¸ª
- **å®šæ—¶å¤‡ä»½**ï¼šä¿ç•™æœ€è¿‘15ä¸ª
- **å¯¼å‡ºå¤‡ä»½**ï¼šæ°¸ä¹…ä¿ç•™ï¼ˆæ‰‹åŠ¨ç®¡ç†ï¼‰

---

## ğŸ” æ•°æ®å®‰å…¨ä¿è¯

### è‡ªåŠ¨åŒ–æ¸…å•

- âœ… **å®æ—¶å¤‡ä»½** - æ¯æ¬¡æ“ä½œè‡ªåŠ¨
- âœ… **å®šæ—¶å¤‡ä»½** - é…ç½®åè‡ªåŠ¨
- âœ… **å¤‡ä»½è½®è½¬** - è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½
- âœ… **æ—¥å¿—è®°å½•** - è‡ªåŠ¨è®°å½•å¤‡ä»½å†å²
- âœ… **é”™è¯¯æ¢å¤** - éšæ—¶å¯ä»å¤‡ä»½æ¢å¤

### æ•°æ®æ¢å¤

```bash
# æŸ¥çœ‹æ‰€æœ‰å¤‡ä»½
ls -lt data-backups/

# æ¢å¤æœ€æ–°å¤‡ä»½
./scripts/restore-data.sh

# ä»å¯¼å‡ºæ¢å¤
./scripts/import-data.sh data-export-*/
```

---

## ğŸ¯ æ¨èé…ç½®

### æœ€ä½³å®è·µç»„åˆ

```bash
# 1. å®æ—¶å¤‡ä»½ï¼ˆå·²å¯ç”¨ï¼‰
âœ… æ— éœ€é…ç½®ï¼Œè‡ªåŠ¨è¿è¡Œ

# 2. é…ç½®å®šæ—¶å¤‡ä»½
./scripts/setup-auto-backup.sh
é€‰æ‹©ï¼šæ¯å¤©å¤‡ä»½ï¼ˆé€‰é¡¹2ï¼‰

# 3. å®šæœŸæ£€æŸ¥
æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡å¤‡ä»½æ—¥å¿—
tail logs/auto-backup.log

# 4. æŒ‰éœ€åŒæ­¥Railway
éœ€è¦æ—¶è¿è¡Œï¼š
./scripts/sync-to-railway.sh
```

---

## ğŸ“ é…ç½®æ­¥éª¤

### å¿«é€Ÿé…ç½®ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# æ­¥éª¤1ï¼šé…ç½®å®šæ—¶å¤‡ä»½
./scripts/setup-auto-backup.sh
# é€‰æ‹©ï¼š2ï¼ˆæ¯å¤©å¤‡ä»½ï¼‰

# æ­¥éª¤2ï¼šéªŒè¯é…ç½®
crontab -l

# æ­¥éª¤3ï¼šåˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# æ­¥éª¤4ï¼šæµ‹è¯•å¤‡ä»½
./scripts/auto-backup.sh

# æ­¥éª¤5ï¼šæŸ¥çœ‹æ—¥å¿—
cat logs/auto-backup.log
```

å®Œæˆï¼âœ…

---

## ğŸ” ç›‘æ§å’ŒéªŒè¯

### æ£€æŸ¥å¤‡ä»½çŠ¶æ€

```bash
# æŸ¥çœ‹å¤‡ä»½æ•°é‡
ls -l data-backups/ | wc -l

# æŸ¥çœ‹æœ€æ–°å¤‡ä»½
ls -lt data-backups/ | head -5

# æŸ¥çœ‹å¤‡ä»½æ—¥å¿—
tail -20 logs/auto-backup.log

# éªŒè¯æ•°æ®å®Œæ•´æ€§
./tests/data-integrity-test.sh
```

### å®šæ—¶ä»»åŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹crontab
crontab -l

# æŸ¥çœ‹cronæ—¥å¿—ï¼ˆMacï¼‰
log show --predicate 'process == "cron"' --last 1h

# æ‰‹åŠ¨è§¦å‘æµ‹è¯•
./scripts/auto-backup.sh
```

---

## ğŸ†˜ æ•…éšœæ’é™¤

### å®šæ—¶ä»»åŠ¡ä¸è¿è¡Œ

**æ£€æŸ¥ï¼š**
```bash
# 1. ç¡®è®¤crontabå·²è®¾ç½®
crontab -l

# 2. æ£€æŸ¥è„šæœ¬æƒé™
ls -l scripts/auto-backup.sh

# 3. æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
./scripts/auto-backup.sh

# 4. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
tail /var/log/system.log
```

### å¤‡ä»½å¤±è´¥

**è§£å†³ï¼š**
```bash
# 1. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 2. æ£€æŸ¥æƒé™
ls -la data/

# 3. æ‰‹åŠ¨å¤‡ä»½æµ‹è¯•
./scripts/backup-data.sh

# 4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
cat logs/auto-backup.log
```

---

## ğŸ“Š æ•°æ®åŒæ­¥æµç¨‹

### æœ¬åœ° â†” Railway åŒæ­¥

```
æœ¬åœ°æ•°æ®å˜åŒ–
    â†“
è‡ªåŠ¨å¤‡ä»½ï¼ˆå®æ—¶ï¼‰
    â†“
å®šæ—¶å¤‡ä»½ï¼ˆæ¯å¤©ï¼‰
    â†“
æ‰‹åŠ¨åŒæ­¥åˆ°Railwayï¼ˆéœ€è¦æ—¶ï¼‰
    â†“
Railwayæ•°æ®æ›´æ–°
```

### åŒæ­¥å‘½ä»¤

```bash
# æŸ¥çœ‹æœ¬åœ°æ•°æ®
cat data/users.json

# åŒæ­¥åˆ°Railway
./scripts/sync-to-railway.sh

# éªŒè¯Railwayæ•°æ®
curl https://lovenote-production.up.railway.app/api/users
```

---

## âœ… é…ç½®éªŒè¯æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥ç¡®ä¿ç³»ç»Ÿæ­£å¸¸ï¼š

- [ ] å®æ—¶å¤‡ä»½å·²å¯ç”¨ï¼ˆè‡ªåŠ¨ï¼‰
- [ ] å®šæ—¶å¤‡ä»½å·²é…ç½®ï¼ˆcrontabï¼‰
- [ ] å¤‡ä»½æ—¥å¿—å¯æŸ¥çœ‹ï¼ˆlogs/ï¼‰
- [ ] å¤‡ä»½æ–‡ä»¶åœ¨å¢é•¿ï¼ˆdata-backups/ï¼‰
- [ ] æ¢å¤è„šæœ¬å¯ç”¨ï¼ˆrestore-data.shï¼‰
- [ ] RailwayåŒæ­¥è„šæœ¬å°±ç»ªï¼ˆsync-to-railway.shï¼‰

---

## ğŸŠ æ€»ç»“

### å½“å‰è‡ªåŠ¨åŒ–çŠ¶æ€

```
âœ… å®æ—¶è‡ªåŠ¨å¤‡ä»½ - å·²å¯ç”¨
â° å®šæ—¶è‡ªåŠ¨å¤‡ä»½ - éœ€é…ç½®ï¼ˆ5åˆ†é’Ÿï¼‰
ğŸ”„ æ•°æ®ç›‘æ§     - å¯é€‰
ğŸš€ RailwayåŒæ­¥  - æŒ‰éœ€
```

### ä¸€é”®é…ç½®

```bash
# é…ç½®æ‰€æœ‰è‡ªåŠ¨åŒ–
./scripts/setup-auto-backup.sh
```

### å®Œå…¨è‡ªåŠ¨åŒ–å

```
âœ… æ— éœ€æ‰‹åŠ¨å¤‡ä»½
âœ… æ•°æ®æ°¸ä¸ä¸¢å¤±  
âœ… è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½
âœ… æ—¥å¿—è‡ªåŠ¨è®°å½•
âœ… éšæ—¶å¯æ¢å¤
```

---

*æœ€åæ›´æ–°: 2025-11-21*  
*ç‰ˆæœ¬: v1.2*  
*çŠ¶æ€: è‡ªåŠ¨åŒ–å°±ç»ª*
